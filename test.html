<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatNow Backend Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        input, textarea { padding: 8px; margin: 5px; width: 200px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ğŸš€ ChatNow Backend Test</h1>
    
    <!-- API Test -->
    <div class="test-section">
        <h2>ğŸ“¡ API Test</h2>
        <button onclick="testAPI()">API BaÄŸlantÄ±sÄ±nÄ± Test Et</button>
        <div id="apiResult" class="result"></div>
    </div>

    <!-- WebSocket Test -->
    <div class="test-section">
        <h2>ğŸ”Œ WebSocket Test</h2>
        <button onclick="connectWebSocket()">WebSocket BaÄŸlan</button>
        <button onclick="disconnectWebSocket()">WebSocket BaÄŸlantÄ±yÄ± Kes</button>
        <div id="wsResult" class="result"></div>
    </div>

    <!-- User Registration Test -->
    <div class="test-section">
        <h2>ğŸ‘¤ KullanÄ±cÄ± KaydÄ± Test</h2>
        <input type="email" id="regEmail" placeholder="E-posta" value="test@example.com">
        <input type="password" id="regPassword" placeholder="Åifre" value="123456">
        <input type="text" id="regName" placeholder="Ad" value="Test">
        <input type="text" id="regSurname" placeholder="Soyad" value="User">
        <input type="number" id="regAge" placeholder="YaÅŸ" value="25">
        <input type="text" id="regLocation" placeholder="Konum" value="Ä°stanbul">
        <select id="regGender">
            <option value="male">Erkek</option>
            <option value="female">KadÄ±n</option>
        </select>
        <br>
        <button onclick="registerUser()">KullanÄ±cÄ± Kaydet</button>
        <div id="regResult" class="result"></div>
    </div>

    <!-- User Login Test -->
    <div class="test-section">
        <h2>ğŸ”‘ KullanÄ±cÄ± GiriÅŸi Test</h2>
        <input type="email" id="loginEmail" placeholder="E-posta" value="test@example.com">
        <input type="password" id="loginPassword" placeholder="Åifre" value="123456">
        <br>
        <button onclick="loginUser()">GiriÅŸ Yap</button>
        <div id="loginResult" class="result"></div>
    </div>

    <!-- Message Test -->
    <div class="test-section">
        <h2>ğŸ’¬ Mesaj Test</h2>
        <input type="text" id="receiverId" placeholder="AlÄ±cÄ± ID" value="">
        <input type="text" id="messageText" placeholder="Mesaj" value="Merhaba!">
        <br>
        <button onclick="sendMessage()">Mesaj GÃ¶nder</button>
        <div id="messageResult" class="result"></div>
    </div>

    <script>
        let socket = null;
        let authToken = null;

        // API Test
        async function testAPI() {
            try {
                const response = await fetch('http://localhost:3000');
                const data = await response.json();
                document.getElementById('apiResult').innerHTML = 
                    `<div class="success">âœ… API Ã‡alÄ±ÅŸÄ±yor!</div>
                     <pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('apiResult').innerHTML = 
                    `<div class="error">âŒ API HatasÄ±: ${error.message}</div>`;
            }
        }

        // WebSocket Test
        function connectWebSocket() {
            try {
                // Socket.IO client kontrolÃ¼
                if (typeof io === 'undefined') {
                    document.getElementById('wsResult').innerHTML = 
                        `<div class="error">âŒ Socket.IO client yÃ¼klenemedi. SayfayÄ± yenileyin.</div>`;
                    return;
                }

                socket = io('http://localhost:3000');
                
                socket.on('connect', () => {
                    document.getElementById('wsResult').innerHTML = 
                        `<div class="success">âœ… WebSocket BaÄŸlandÄ±! Socket ID: ${socket.id}</div>`;
                });

                socket.on('connect_error', (error) => {
                    document.getElementById('wsResult').innerHTML = 
                        `<div class="error">âŒ WebSocket BaÄŸlantÄ± HatasÄ±: ${error.message}</div>`;
                });

                socket.on('newMessage', (data) => {
                    document.getElementById('wsResult').innerHTML += 
                        `<div class="info">ğŸ“¨ Yeni Mesaj: ${JSON.stringify(data)}</div>`;
                });

                socket.on('disconnect', () => {
                    document.getElementById('wsResult').innerHTML += 
                        `<div class="error">âŒ WebSocket BaÄŸlantÄ±sÄ± Kesildi</div>`;
                });

            } catch (error) {
                document.getElementById('wsResult').innerHTML = 
                    `<div class="error">âŒ WebSocket HatasÄ±: ${error.message}</div>`;
            }
        }

        function disconnectWebSocket() {
            if (socket) {
                socket.disconnect();
                socket = null;
                document.getElementById('wsResult').innerHTML += 
                    `<div class="info">ğŸ”Œ WebSocket BaÄŸlantÄ±sÄ± KapatÄ±ldÄ±</div>`;
            }
        }

        // User Registration
        async function registerUser() {
            try {
                const userData = {
                    email: document.getElementById('regEmail').value,
                    password: document.getElementById('regPassword').value,
                    name: document.getElementById('regName').value,
                    surname: document.getElementById('regSurname').value,
                    age: parseInt(document.getElementById('regAge').value),
                    location: document.getElementById('regLocation').value,
                    gender: document.getElementById('regGender').value
                };

                const response = await fetch('http://localhost:3000/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    document.getElementById('regResult').innerHTML = 
                        `<div class="success">âœ… KullanÄ±cÄ± Kaydedildi!</div>
                         <pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    document.getElementById('regResult').innerHTML = 
                        `<div class="error">âŒ KayÄ±t HatasÄ±: ${data.message}</div>`;
                }
            } catch (error) {
                document.getElementById('regResult').innerHTML = 
                    `<div class="error">âŒ KayÄ±t HatasÄ±: ${error.message}</div>`;
            }
        }

        // User Login
        async function loginUser() {
            try {
                const loginData = {
                    email: document.getElementById('loginEmail').value,
                    password: document.getElementById('loginPassword').value
                };

                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    document.getElementById('loginResult').innerHTML = 
                        `<div class="success">âœ… GiriÅŸ BaÅŸarÄ±lÄ±!</div>
                         <pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    document.getElementById('loginResult').innerHTML = 
                        `<div class="error">âŒ GiriÅŸ HatasÄ±: ${data.message}</div>`;
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 
                    `<div class="error">âŒ GiriÅŸ HatasÄ±: ${error.message}</div>`;
            }
        }

        // Send Message
        async function sendMessage() {
            if (!authToken) {
                document.getElementById('messageResult').innerHTML = 
                    `<div class="error">âŒ Ã–nce giriÅŸ yapmalÄ±sÄ±nÄ±z!</div>`;
                return;
            }

            try {
                const messageData = {
                    receiverId: document.getElementById('receiverId').value,
                    text: document.getElementById('messageText').value
                };

                const response = await fetch('http://localhost:3000/api/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(messageData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('messageResult').innerHTML = 
                        `<div class="success">âœ… Mesaj GÃ¶nderildi!</div>
                         <pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    document.getElementById('messageResult').innerHTML = 
                        `<div class="error">âŒ Mesaj HatasÄ±: ${data.message}</div>`;
                }
            } catch (error) {
                document.getElementById('messageResult').innerHTML = 
                    `<div class="error">âŒ Mesaj HatasÄ±: ${error.message}</div>`;
            }
        }

        // Sayfa yÃ¼klendiÄŸinde API testini Ã§alÄ±ÅŸtÄ±r
        window.onload = function() {
            testAPI();
        };
    </script>
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</body>
</html>
